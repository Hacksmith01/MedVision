<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Pneumonia Detection ‚Äî Upload</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script defer src="{{ url_for('static', filename='scripts.js') }}"></script>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="hero-left">
        <h1 class="center-title">
          MedVision
        </h1>
        <h3>SMART PNEUMONIA DECTECTION SYSTEM</h3>
        <p class="lead">Upload a chest X-ray image (jpg, jpeg, or png) to analyze it using advanced image similarity metrics (SSIM/MSE) and deep learning CNN models. 
          Get comprehensive analysis results with confidence scores.</p>
      </div>
      <div class="hero-right">
        <div class="hero-buttons">
          <button id="info-toggle" class="btn ghost">üìö Learn about the tech</button>
          <button id="sample-btn" class="btn">üéØ Try sample image</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="upload-card">
        <form id="upload-form" action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data">
          <div id="drop-zone" class="drop-zone">
            <input id="file-input" name="file" type="file" accept="image/*">
            <div class="drop-inner">
              <p id="drop-text">Drag & drop an X-ray here, or click to choose</p>
              <img id="preview" class="preview" alt="preview" style="display:none;">
            </div>
          </div>
          <div class="controls">
            <button type="submit" class="btn primary">Analyze Image</button>
            <a id="download-report" class="btn ghost" style="display:none;">Download report</a>
          </div>
        </form>
      </section>

      <aside id="learn" class="learn" aria-hidden="true" style="display: none;">
        <h2>üìö Quick Guide</h2>
        <p class="guide-intro">Learn how our pneumonia detection system works and what each component does.</p>

        <div class="accordion">
          <button class="acc-head">üîç What is SSIM & MSE?</button>
          <div class="acc-body">
            <ul>
              <li><strong>SSIM (Structural Similarity Index)</strong> measures structural similarity between images, focusing on textures, patterns, and overall image structure. Values range from 0 to 1, where 1 means identical images.</li>
              <li><strong>MSE (Mean Squared Error)</strong> measures pixel-by-pixel differences between images. Lower MSE values indicate more similar images.</li>
              <li>We compare your uploaded X-ray to labeled samples from our dataset (Normal / Pneumonia) and compute median similarity scores to determine the closest match.</li>
              <li>The system uses a confidence margin to avoid false classifications when scores are too close.</li>
            </ul>
          </div>

          <button class="acc-head">üß† What the CNN Does</button>
          <div class="acc-body">
            <p><strong>Convolutional Neural Network (CNN)</strong> is a deep learning model trained on thousands of chest X-ray images. It learns hierarchical features:</p>
            <ul>
              <li><strong>Low-level:</strong> Edges, lines, and basic shapes</li>
              <li><strong>Mid-level:</strong> Patterns and textures</li>
              <li><strong>High-level:</strong> Complex features specific to pneumonia</li>
            </ul>
            <p>The CNN outputs a probability score (0-100%) indicating the likelihood of pneumonia. This method is generally more reliable than simple similarity metrics as it's trained on a large, diverse dataset.</p>
          </div>

          <button class="acc-head">‚öôÔ∏è Image Preprocessing</button>
          <div class="acc-body">
            <p>Before analysis, all images undergo preprocessing to ensure consistent comparisons:</p>
            <ul>
              <li><strong>Grayscale conversion:</strong> Converts color images to grayscale for uniformity</li>
              <li><strong>CLAHE (Contrast Limited Adaptive Histogram Equalization):</strong> Enhances contrast to improve feature visibility</li>
              <li><strong>Resizing:</strong> Standardizes image dimensions</li>
              <li><strong>Denoising:</strong> Reduces image noise that could affect accuracy</li>
            </ul>
            <p>This preprocessing ensures fair comparisons between your image and the dataset samples.</p>
          </div>

          <button class="acc-head">ü§ñ How Results Are Combined</button>
          <div class="acc-body">
            <p>Our system uses a dual-approach method:</p>
            <ul>
              <li><strong>SSIM/MSE Comparison:</strong> Compares your image to known samples using similarity metrics</li>
              <li><strong>CNN Prediction:</strong> Uses deep learning to analyze image features</li>
            </ul>
            <p>When both methods agree, confidence is high. If they disagree, the CNN result is generally preferred, but we recommend taking precautions and consulting a medical professional for a definitive diagnosis.</p>
          </div>

          <button class="acc-head">‚ö†Ô∏è Important Disclaimers</button>
          <div class="acc-body">
            <p><strong>This tool is for educational and research purposes only.</strong></p>
            <ul>
              <li>Not a medical device or diagnostic tool</li>
              <li>Results should not replace professional medical consultation</li>
              <li>Always consult with a licensed healthcare provider for medical decisions</li>
              <li>If you have concerns about your health, seek immediate medical attention</li>
            </ul>
          </div>
        </div>

        <div class="examples">
          <h3>üéØ Try a Sample Image</h3>
          <p>Want to test the system? Click the <strong>"Try sample image"</strong> button above to automatically load a sample chest X-ray from our dataset. This will help you see how the analysis works before uploading your own image.</p>
          <div class="sample-info">
            <p><small>üí° Tip: The sample image will be randomly selected from either Normal or Pneumonia categories.</small></p>
          </div>
        </div>

      </aside>
    </main>

    <footer class="footer">
      <small>Built with Python, Flask, OpenCV, scikit-image ‚Äî not a medical device. Results are for research/educational use only.</small>
    </footer>
  </div>
</body>
</html>
